<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Random Strings</title>
  <link rel="stylesheet" type="text/css" href="./css/styles.css" />
  <link rel="shortcut icon" href="favicon.ico" />
  <link type="text/css" rel="StyleSheet" href="./css/winclassic.css" />
  <script language="JavaScript" type="text/javascript" src="./js/jscript.js"></script>
  <script type="text/javascript" src="./js/range.js"></script>
  <script type="text/javascript" src="./js/timer.js"></script>
  <script type="text/javascript" src="./js/slider.js"></script>
  <script type="text/javascript" src="./js/canvasUtil.js"></script>
</head>

<body onload="init();">


<div class="container">

<div class="topsmall">

<div class="topleftsmall">
   <a href="./index.html">
  <script type="text/javascript">
          showImage("300x50");
     </script>
   </a>
</div>

<h1><a href="./index.html">Michael Bradford Williams</a></h1>

</div>

<div class="middle">

<h2>Random Strings</h2>

<p>In yet another <a href="http://en.wikipedia.org/wiki/Canvas_(HTML_element)">HTML canvas</a> experiment, I tried to model
(somewhat) random motion.  A single particle moves randomly at a certain speed, while tracing out its path.  It isn't completely random, since its forward direction
is restricted to a certain angle.  After some random amount of time, the particle splits off into two new ones.  This continues until
the maximum number of splits has been reached.  At each split, the color of the new particles lightens a bit.</p>

<p>Below are controls for the applet, which should be self-explanatory.  There are also two
larger versions (without the controls): <a href="./strings3.html">one like that below</a>, or
<a href="./strings2.html">one with a somewhat more organic color scheme</a>.</p>

<p>You'll need a modern browser to view it (e.g. <a href="http://www.mozilla.com/firefox/">Firefox</a>,
<a href="http://www.google.com/chrome">Chrome</a>, <a href="http://www.apple.com/safari/">Safari</a>). </p>
</div>

<div class="middle">

<table border="0" cell-padding="0">
  <tr>
    <td align="right"><p>Maximum Splits:</p></td>
    <td><div class="slider" id="splitSlider" tabIndex="1"><input class="slider-input" id="splitSliderInput"/></div></td>
    <td> </td>
    <td align="right"><p>Split Probability:</p></td>
    <td><div class="slider" id="splitProbSlider" tabIndex="1"><input class="slider-input" id="splitProbSliderInput"/></div></td>
    <td> </td>
    <td> </td>
    <td><input type="button" name="refresh" value="Refresh" onClick="init();">
  </tr>
  <tr>
    <td align="right"><p>Average Speed:</p></td>
    <td><div class="slider" id="speedSlider" tabIndex="1"><input class="slider-input" id="speedSliderInput"/></div></td>
    <td> </td>
    <td align="right"><p>Turning Angle:</p></td>
    <td><div class="slider" id="angleSlider" tabIndex="1"><input class="slider-input" id="angleSliderInput"/></div></td>
    <td> </td>
    <td> </td>
    <td><input type="button" name="stop" value="Pause" onClick="stopDrawing();">
  </tr>
</table>

<script type="text/javascript">

var canvas;
var ctx;
var WIDTH = 750;
var HEIGHT = 750;
var canvasUtil;
var stop = false;

var N = 1;
var splitLimit = 200;

var dsAvg = 0.75;
var dsVar = 0.35;

var particles = [];

var biasProb = 0.05;
var angle = Math.PI/3;

var indexToSplit = 0;
var canSplit = false;
var splitProb = 0.035;

const MAX_WIDTH = 1;

const BG_COLOR = new Color(105, 105, 0);
const BLACK = new Color(0, 0, 0);
const WHITE = new Color(255, 255, 255);

const SLIDER_MIN = 0;
const SLIDER_MAX = 50;

const SPLIT_LIMIT_MIN = 1;
const SPLIT_LIMIT_DEFAULT = 200;
const SPLIT_LIMIT_MAX = 400;

const SPLIT_PROB_MIN = 0.01;
const SPLIT_PROB_DEFAULT = 0.03;
const SPLIT_PROB_MAX = 0.05;

const SPEED_MIN = 0.05;
const SPEED_DEFAULT = 1.0;
const SPEED_MAX = 2.5;

const ANGLE_MIN = Math.PI / 12;
const ANGLE_DEFAULT = Math.PI / 4;
const ANGLE_MAX = 2 * Math.PI / 3;

var splitSl = new Slider(document.getElementById("splitSlider"), document.getElementById("splitSliderInput"));
splitSl.setMinimum(SLIDER_MIN);
splitSl.setMaximum(SLIDER_MAX);
splitSl.setValue(
  actualToSlider(
    splitSl.getMinimum(),
    splitSl.getMaximum(),
    SPLIT_LIMIT_MIN,
    SPLIT_LIMIT_MAX,
    SPLIT_LIMIT_DEFAULT
  )
);

var splitProbSl = new Slider(document.getElementById("splitProbSlider"), document.getElementById("splitProbSliderInput"));
splitProbSl.setMinimum(SLIDER_MIN);
splitProbSl.setMaximum(SLIDER_MAX);
splitProbSl.setValue(
  actualToSlider(
    splitProbSl.getMinimum(),
    splitProbSl.getMaximum(),
    SPLIT_PROB_MIN,
    SPLIT_PROB_MAX,
    SPLIT_PROB_DEFAULT
  )
);

var speedSl = new Slider(document.getElementById("speedSlider"), document.getElementById("speedSliderInput"));
speedSl.setMinimum(SLIDER_MIN);
speedSl.setMaximum(SLIDER_MAX);
speedSl.setValue(
  actualToSlider(
    speedSl.getMinimum(),
    speedSl.getMaximum(),
    SPEED_MIN,
    SPEED_MAX,
    SPEED_DEFAULT
  )
);

var angleSl = new Slider(document.getElementById("angleSlider"), document.getElementById("angleSliderInput"));
angleSl.setMinimum(SLIDER_MIN);
angleSl.setMaximum(SLIDER_MAX);
angleSl.setValue(
  actualToSlider(
    angleSl.getMinimum(),
    angleSl.getMaximum(),
    ANGLE_MIN,
    ANGLE_MAX,
    ANGLE_DEFAULT
  )
);

splitSl.onchange = function () {
  splitLimit = sliderToActual(
    splitSl.getMinimum(),
    splitSl.getMaximum(),
    SPLIT_LIMIT_MIN,
    SPLIT_LIMIT_MAX,
    splitSl.getValue()
  );
};

splitProbSl.onchange = function () {
  splitProb = sliderToActual(
    splitProbSl.getMinimum(),
    splitProbSl.getMaximum(),
    SPLIT_PROB_MIN,
    SPLIT_PROB_MAX,
    splitProbSl.getValue()
  );
};

speedSl.onchange = function () {
  dsAvg = sliderToActual(
    speedSl.getMinimum(),
    speedSl.getMaximum(),
    SPEED_MIN,
    SPEED_MAX,
    speedSl.getValue()
  );
  dsVar = dsAvg/3;
};

angleSl.onchange = function () {
  angle = sliderToActual(
    angleSl.getMinimum(),
    angleSl.getMaximum(),
    ANGLE_MIN,
    ANGLE_MAX,
    angleSl.getValue()
  );
};

window.onresize = function () {
  splitSl.recalculate();
  splitProbSl.recalculate();
  speedSl.recalculate();
  angleSl.recalculate();
};

function stopDrawing() {
  stop = !stop;
}


function draw() {
  if (stop) {
    return 0;
  }

  if (Math.random() < splitProb && N < splitLimit) {
    canSplit = true;
    indexToSplit = Math.round(Math.random() * N);
  }
  else {
    canSplit = false;
  }

  var tempN = N;
  for (var i=0; i<tempN; i++) {
    if (canSplit == true && i == indexToSplit) {
      N++;
      var t = N / splitLimit;
      let newColor = Color.interpolate(BLACK, WHITE, t).toString();
      let newWidth = Math.max(particles[i].width - 1, 1);
      particles[i].width = newWidth;

      //make a new particle: curPos, lastPos, ds, theta, bias, color
      let newParticle = new Particle(
        new Vec2D(particles[i].curPos.x, particles[i].curPos.y),
        new Vec2D(particles[i].lastPos.x, particles[i].lastPos.y),
        Math.random() * dsAvg + dsVar,
        particles[i].theta * -1,
        particles[i].bias * -1,
        newColor,
        newWidth
      )
      particles.push(newParticle);

      // update the existing and new particle
      particles[i].update();
      particles[N-1].update();
    }
    else {
      particles[i].setTheta();
      if (Math.random() < biasProb) {
        particles[i].flipBias();
      }
      particles[i].update();
    }
    particles[i].draw();
  }
}

class Particle {
  constructor(curPos, lastPos, ds, theta, bias, color, width) {
    this.curPos = curPos; // Vec2D
    this.lastPos = lastPos; // Vec2D
    this.ds = ds;
    this.theta = theta;
    this.bias = bias;
    this.color = color;
    this.width = width;
  }

  toString() {
    return `current position = ${this.curPos.toString()}; previous position = ${this.lastPos.toString()}; ds = ${this.ds.toFixed(3)}; theta = ${this.theta.toFixed(3)}; color = ${this.color}; bias = ${this.bias}; width = ${this.width}`;
  }


  flipBias() {
    this.bias *= -1;
  }

  draw() {
    canvasUtil.drawLine(this.lastPos.x, this.lastPos.y, this.curPos.x, this.curPos.y, this.color, this.width);
  }

  setTheta() {
    this.theta = this.bias * (Math.random() * angle - angle / 2);
  }

  update() {
    // get direction in which to move
    let dir = this.curPos.minus(this.lastPos).rotate(this.theta).toUnitVector();

    // make sure the new position is inside the canvas
    if (this.curPos.x + this.ds * dir.x > WIDTH || this.curPos.x + this.ds * dir.x < 0) {
      dir.x *= -1;
      this.bias *= -1;
    }
    if (this.curPos.y + this.ds * dir.y > HEIGHT || this.curPos.y + this.ds * dir.y < 0) {
      dir.y *= -1;
      this.bias *= -1;
    }

    // update previous position, set new position p0 <- po + dir * ds
    this.lastPos = this.curPos;
    this.curPos = this.curPos.plus(dir.scale(this.ds));
  }
}

function refreshDrawing() {
  //canvasUtil.println("refreshing");
  N = 1;

  indexToSplit = 0;
  canSplit = false;
  splitProb = 0.035;

  //make a new particle: curPos, lastPos, ds, theta, bias, color
  let ds0 = Math.random() * dsAvg + dsVar;
  let theta0 = Math.random() * Math.PI * 2
  let p0 = new Vec2D(WIDTH / 2, HEIGHT / 2);
  let dir = new Vec2D(Math.cos(theta0), Math.sin(theta0));
  let particle = new Particle(
    p0.plus(dir.scale(ds0)),
    p0,
    ds0,
    theta0,
    1,
    BLACK,
    MAX_WIDTH
  )
  particles = [particle];
  canvasUtil.clearCanvas(BG_COLOR.toString());
}


function init() {
  canvas = document.getElementById("canvas");
  canvas.width = WIDTH;
  canvas.height = HEIGHT;
  if (canvas.getContext){
    ctx = canvas.getContext('2d');
    canvasUtil = new CanvasUtil(ctx, WIDTH, HEIGHT, document.outform.output);
    refreshDrawing();
    return setInterval(draw, 10);
  }
  else {
    alert('You need a better web browser to see this.');
  }
}

</script>

</div>

<div class="middle">
    <canvas id="canvas" width="750" height="750">
        <p>Your browser is currently unsupported.</p>
        <p>Supported browsers: <a href="http://www.opera.com">Opera</a>, <a
          href="http://www.mozilla.com">Firefox</a>, <a
          href="http://www.apple.com/safari">Safari</a>, and <a
          href="http://www.konqueror.org">Konqueror</a>.</p>
    </canvas>
</div>

<div class="middle">
<center>
<form name="outform">
  <textarea rows="10" cols="80" name="output"></textarea>
</form>
</center>
</div>

<div class="bottom">
<p>last modified: 2/17/2010</p>
</div>

</div>

</body>
</html>
