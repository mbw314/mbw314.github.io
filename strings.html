<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Random Strings</title>
	<link rel="stylesheet" type="text/css" href="./css/styles.css" />
	<link rel="shortcut icon" href="favicon.ico" />
	<link type="text/css" rel="StyleSheet" href="./css/winclassic.css" />
	<script language="JavaScript" type="text/javascript" src="./js/jscript.js"></script>
	<script type="text/javascript" src="./js/range.js"></script>
	<script type="text/javascript" src="./js/timer.js"></script>
	<script type="text/javascript" src="./js/slider.js"></script>
</head>

 <body onload="init();">


<div class="container">

<div class="topsmall">

<div class="topleftsmall">
   <a href="./index.html">
	<script type="text/javascript">
      		showImage("300x50");
   	</script>
   </a>
</div>

<h1><a href="./index.html">Michael Bradford Williams</a></h1>

</div>

<div class="middle">

<h2>Random Strings</h2>

<p>In yet another <a href="http://en.wikipedia.org/wiki/Canvas_(HTML_element)">HTML canvas</a> experiment, I tried to model
(somewhat) random motion.  A single particle moves randomly at a certain speed, while tracing out its path.  It isn't completely random, since its forward direction
is restricted to a certain angle.  After some random amount of time, the particle splits off into two new ones.  This continues until
the maximum number of splits has been reached.  At each split, the color of the new particles lightens a bit.</p>

<p>Below are controls for the applet, which should be self-explanatory.  There are also two
larger versions (without the controls): <a href="./strings3.html">one like that below</a>, or
<a href="./strings2.html">one with a somewhat more organic color scheme</a>.</p>

<p>You'll need a modern browser to view it (e.g. <a href="http://www.mozilla.com/firefox/">Firefox</a>,
<a href="http://www.google.com/chrome">Chrome</a>, <a href="http://www.apple.com/safari/">Safari</a>). </p>
</div>

<div class="middle">

<table border="0" cell-padding="0">
	<tr>
		<td align="right"><p>Maximum Splits:</p></td>
		<td><div class="slider" id="splitSlider" tabIndex="1"><input class="slider-input" id="splitSliderInput"/></div></td>
		<td> </td>
		<td align="right"><p>Split Probability:</p></td>
		<td><div class="slider" id="splitProbSlider" tabIndex="1"><input class="slider-input" id="splitProbSliderInput"/></div></td>
		<td> </td>
		<td> </td>
		<td><input type="button" name="refresh" value="Refresh" onClick="init();">
	</tr>
	<tr>
		<td align="right"><p>Average Speed:</p></td>
		<td><div class="slider" id="speedSlider" tabIndex="1"><input class="slider-input" id="speedSliderInput"/></div></td>
		<td> </td>
		<td align="right"><p>Turning Angle:</p></td>
		<td><div class="slider" id="angleSlider" tabIndex="1"><input class="slider-input" id="angleSliderInput"/></div></td>
		<td> </td>
		<td> </td>
		<td><input type="button" name="stop" value="Pause" onClick="stopDrawing();">
	</tr>
</table>

<script type="text/javascript">

var canvas,ctx;
var width = 750;//window.outerWidth;
var height = 750;//window.outerHeight;
var WIDTH = 750;
var HEIGHT = 750;
var canvasMinX;
var canvasMinY;
var stop = false;

var N = 1;
var N_MAX = 200;
var N_LIMIT = 400;

var ds_avg = 0.75;
var ds_var = 0.35;

var posXcur;
var posXlast;
var posYcur;
var posYlast;
var color;
var ds;
var theta;
var bias;
var bias_prob = 0.05;
var angle = Math.PI/3;

var splitter = 0;
var splitting = false;
var split_prob = 0.035;

var r_bg = 105;
var g_bg = 105;
var b_bg = 0;

var r0 = 0;
var g0 = 0;
var b0 = 0;

var r1 = 255;
var g1 = 255;
var b1 = 255;

var splitSl = new Slider(document.getElementById("splitSlider"), document.getElementById("splitSliderInput"));
splitSl.setMinimum(0);
splitSl.setValue(20);
splitSl.setMaximum(50);

var splitProbSl = new Slider(document.getElementById("splitProbSlider"), document.getElementById("splitProbSliderInput"));
splitProbSl.setMinimum(0);
splitProbSl.setValue(33);
splitProbSl.setMaximum(50);

var speedSl = new Slider(document.getElementById("speedSlider"), document.getElementById("speedSliderInput"));
speedSl.setMinimum(0);
speedSl.setValue(15);
speedSl.setMaximum(50);

var angleSl = new Slider(document.getElementById("angleSlider"), document.getElementById("angleSliderInput"));
angleSl.setMinimum(0);
angleSl.setValue(24);
angleSl.setMaximum(50);

splitSl.onchange = function () {
	var a = splitSl.getMinimum();
	var b = splitSl.getMaximum();
	var c = 1
	var d = N_LIMIT;
	var x = splitSl.getValue();

	N_MAX = (d-c)*(x-a)/(b-a) + c;
};

splitProbSl.onchange = function () {
	var a = splitProbSl.getMinimum();
	var b = splitProbSl.getMaximum();
	var c = 0.001;
	var d = 0.05;
	var x = splitProbSl.getValue();

	split_prob = (d-c)*(x-a)/(b-a) + c;
};

speedSl.onchange = function () {
	var a = speedSl.getMinimum();
	var b = speedSl.getMaximum();
	var c = 0.05;
	var d = 2.5;
	var x = speedSl.getValue();

	ds_avg = (d-c)*(x-a)/(b-a) + c;
	ds_var = ds_avg/3;
};

angleSl.onchange = function () {
	var a = angleSl.getMinimum();
	var b = angleSl.getMaximum();
	var c = Math.PI/12;
	var d = 2*Math.PI/3;
	var x = angleSl.getValue();

	angle = (d-c)*(x-a)/(b-a) + c;
};



window.onresize = function () {
	splitSl.recalculate();
	splitProbSl.recalculate();
	speedSl.recalculate();
	angleSl.recalculate();
};

function stopDrawing() {
	stop = !stop;
}


function init(){

	// get the canvas element using the DOM
	canvas = document.getElementById("canvas");
	//canvas.width = width - 50;
	//canvas.height = height - 300;
	//WIDTH = canvas.width;
	//HEIGHT = canvas.height;

	canvasMinX = findPos(canvas)[0];
	canvasMinY = findPos(canvas)[1];

	// Make sure we don't execute when canvas isn't supported
	if (canvas.getContext){
		// use getContext to use the canvas for drawing
		ctx = canvas.getContext('2d');

		// Attach the mousemove event handler.
		canvas.addEventListener('mousemove', ev_mousemove, false);

		// initialize
		N = 1;

		posXcur = new Array(1);
		posXlast = new Array(1);
		posYcur = new Array(1);
		posYlast = new Array(1);
		color = new Array(1);
		ds = new Array(1);
		theta = new Array(1);
		bias = new Array(1);
		bias_prob = 0.05;

		splitter = 0;
		splitting = false;
		split_prob = 0.035;

		ds[0] = Math.random()*ds_avg + ds_var;
		theta[0] = Math.random()*Math.PI*2;
		posXlast[0] = WIDTH/2;//Math.round(Math.random()*WIDTH);
		posYlast[0] = HEIGHT/2;//Math.round(Math.random()*HEIGHT);
		posXcur[0] = ds[0]*Math.cos(theta[0]) + posXlast[0];
		posYcur[0] = ds[0]*Math.sin(theta[0]) + posYlast[0];
		color[0] =  'rgb(' + r0 + ',' + g0 + ',' + b0 + ')';	//"rgb(0,0,0)";
		bias[0] = 1;

		ctx.fillStyle = 'rgb(' + r_bg + ',' + g_bg + ',' + b_bg + ')';
		ctx.fillRect(0,0,width,height);

		// call the drawing function
		return setInterval(draw, 10);
	}
	else { alert('You need a better web browser to see this.'); }
}


function rect(x,y,w,h) {
	ctx.beginPath();
	ctx.rect(x,y,w,h);
	ctx.closePath();
	ctx.fill();
}

function clear() {
	ctx.clearRect(0, 0, WIDTH, HEIGHT);
}

function drawLine(x0,y0,x1,y1,c) {
	ctx.beginPath();
	ctx.strokeStyle = c;
	ctx.moveTo(x0,y0);
	ctx.lineTo(x1,y1);
	ctx.closePath();
	ctx.stroke();
}

function drawDot(x,y,r,c) {
	ctx.beginPath();
	ctx.fillStyle = c;
	ctx.arc(x,y,r,0,2*Math.PI,true);
	ctx.closePath();
	ctx.fill();
}


function draw() {

	if (stop == false) {
		if (Math.random() < split_prob && N < N_MAX) {
			splitting = true;
			splitter = Math.round(Math.random()*N);
		}
		else splitting = false;

		var tempN = N;
		for (var i=0; i<tempN; i++) {

			if (splitting == true && i == splitter) {

				// make arrays longer
				N++;
				//document.outform.output.value = 'N = ' + N + ' split_prob = ' + split_prob + ' avg speed = ' + ds_avg + ' angle = ' + angle;
				posXlast.length++;
				posYlast.length++;
				posXcur.length++;
				posYcur.length++;
				color.length++;
				ds.length++;
				theta.length++;
				bias.length++;

				// fill in last spots of arrays

				var t = N/N_MAX;

				var r = Math.round( r0*(1-t) + r1*t );  // straight-line
				var g = Math.round( g0*(1-t) + g1*t );
				var b = Math.round( b0*(1-t) + b1*t );


				//document.outform.output.value = 'N = ' + N + ', (r,g,b) = (' + r + ',' + g + ',' + b + ')';

				color[N-1] = 'rgb(' + r + ',' + g + ',' + b + ')';

				bias[N-1] = -1*bias[i];
				theta[i]   = Math.PI/3;
				theta[N-1] = -1*theta[i];
				ds[N-1] = Math.random()*ds_avg + ds_var;

				posXlast[N-1] = posXlast[i];
				posYlast[N-1] = posYlast[i];

				posXcur[N-1] = posXcur[i];
				posYcur[N-1] = posYcur[i]

				var dispX1 = (posXcur[i] - posXlast[i])*Math.cos(theta[i]) - (posYcur[i] - posYlast[i])*Math.sin(theta[i]);
				var dispY1 = (posXcur[i] - posXlast[i])*Math.sin(theta[i]) + (posYcur[i] - posYlast[i])*Math.cos(theta[i]);

				var norm1 = ds[i]/Math.sqrt( dispX1*dispX1 + dispY1*dispY1 );

				if (posXcur[i] + dispX1*norm1 > WIDTH || posXcur[i] + dispX1*norm1 < 0) {
					dispX1 = -dispX1;
					bias[i] *= -1;
				}
				if (posYcur[i] + dispY1*norm1 > HEIGHT || posYcur[i] + dispY1*norm1 < 0) {
					dispY1 = -dispY1;
					bias[i] *= -1;
				}

				posXlast[i] = posXcur[i];
				posXcur[i] += dispX1*norm1;
				posYlast[i] = posYcur[i];
				posYcur[i] += dispY1*norm1;


				var dispX2 = (posXcur[N-1] - posXlast[N-1])*Math.cos(theta[N-1]) - (posYcur[N-1] - posYlast[N-1])*Math.sin(theta[N-1]);
				var dispY2 = (posXcur[N-1] - posXlast[N-1])*Math.sin(theta[N-1]) + (posYcur[N-1] - posYlast[N-1])*Math.cos(theta[N-1]);

				var norm2 = ds[N-1]/Math.sqrt( dispX2*dispX2 + dispY2*dispY2 );

				if (posXcur[N-1] + dispX2*norm2 > WIDTH || posXcur[N-1] + dispX2*norm2 < 0) {
					dispX2 = -dispX2;
					bias[N-1] *= -1;
				}
				if (posYcur[N-1] + dispY2*norm2 > HEIGHT || posYcur[N-1] + dispY2*norm2 < 0) {
					dispY2 = -dispY2;
					bias[N-1] *= -1;
				}

				posXlast[N-1] = posXcur[N-1];
				posXcur[N-1] += dispX2*norm2;
				posYlast[N-1] = posYcur[N-1];
				posYcur[N-1] += dispY2*norm2;

			}
			else {
				//theta[i] = bias[i]*(Math.random()*Math.PI/3 - Math.PI/6);
				theta[i] = bias[i]*(Math.random()*angle - angle/2);

				//document.outform.output.value = 'N = ' + N + ' split_prob = ' + split_prob + ' avg speed = ' + ds_avg + ' angle = ' + angle;

				if (Math.random() < bias_prob) {
					bias[0] *= -1;
					//document.outform.output.value += 'bias changed ';
				}

				var dispX = (posXcur[i] - posXlast[i])*Math.cos(theta[i]) - (posYcur[i] - posYlast[i])*Math.sin(theta[i]);
				var dispY = (posXcur[i] - posXlast[i])*Math.sin(theta[i]) + (posYcur[i] - posYlast[i])*Math.cos(theta[i]);

				var norm = ds[i]/Math.sqrt( dispX*dispX + dispY*dispY );

				if (posXcur[i] + dispX*norm > WIDTH || posXcur[i] + dispX*norm < 0) {
					dispX = -dispX;
					bias[i] *= -1;
				}
				if (posYcur[i] + dispY*norm > HEIGHT || posYcur[i] + dispY*norm < 0) {
					dispY = -dispY;
					bias[i] *= -1;
				}

				posXlast[i] = posXcur[i];
				posXcur[i] += dispX*norm;
				posYlast[i] = posYcur[i];
				posYcur[i] += dispY*norm;
			}

			drawLine(posXlast[i], posYlast[i], posXcur[i], posYcur[i], color[i], 1);
		}
	}
}

function ev_mousemove (ev) {
	// Get the mouse position relative to the canvas element.
	if (ev.layerX || ev.layerX == 0) { // Firefox
		x_mouse = ev.layerX - canvasMinX;
		y_mouse = ev.layerY - canvasMinY;
	} else if (ev.offsetX || ev.offsetX == 0) { // Opera
		x_mouse = ev.offsetX - canvasMinX;
		y_mouse = ev.offsetY - canvasMinY;
	}
}

// find the position of the upper-left corner of an object (e.g., the canvase)
function findPos(obj) {
	var curLeft = 0;
	var curTop = 0;

	if(obj.offsetParent) {
		do {
			curLeft += obj.offsetLeft;
			curTop += obj.offsetTop;
		} while (obj = obj.offsetParent);
	}

	return [curLeft,curTop];
}

</script>

</div>

<div class="middle">
    <canvas id="canvas" width="750" height="750">
        <p>Your browser is currently unsupported.</p>
        <p>Supported browsers: <a href="http://www.opera.com">Opera</a>, <a
          href="http://www.mozilla.com">Firefox</a>, <a
          href="http://www.apple.com/safari">Safari</a>, and <a
          href="http://www.konqueror.org">Konqueror</a>.</p>
    </canvas>
</div>

<!--
<div class="middle">
<center>
<form name="outform">
	<textarea rows="1" cols="80" name="output"></textarea>
</form>
</center>
</div>
-->

<div class="bottom">
<p>last modified: 2/17/2010</p>
</div>

</div>

</body>
</html>
