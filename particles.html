<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />	
	<title>Particles</title>
	<link rel="stylesheet" type="text/css" href="./css/styles.css" /> 
	<link rel="shortcut icon" href="favicon.ico" />
	<script language="JavaScript" type="text/javascript" src="./js/jscript.js"></script>
	<link type="text/css" rel="StyleSheet" href="./css/winclassic.css" />
	<script type="text/javascript" src="./js/range.js"></script>
	<script type="text/javascript" src="./js/timer.js"></script>
	<script type="text/javascript" src="./js/slider.js"></script>
</head> 

 <body onload="init();">
	
<div class="container">

<div class="topsmall">

<div class="topleftsmall">
   <a href="./index.html">
	<script type="text/javascript">
      		showImage("300x50");
   	</script>
   </a>
</div>

<h1><a href="./index.html">Michael Bradford Williams</a></h1>
</div>

<div class="middle">

<h2>Particles in a gravitational field</h2>

<p>Here's a simple simulation of particles (the colorful circles) in a (classical) gravitational field generated by randomly placed attractors (the white circles).  The controls should be self-explanatory.</p>

<p>You'll need a modern browser to view the app. It has been tested in <a 
href="http://www.mozilla.com/firefox/">Firefox</a> (Windows/Linux) and <a 
href="http://www.google.com/chrome">Chrome</a> (Windows).</p> </div>

<div class="middle">

	<table border="0" align="center">
		
		<tr>	
			<td align="right"><p>Number of Particles:</p></td>
			<td><div class="slider" id="partSlider" tabIndex="1">
				<input class="slider-input" id="partSliderInput"/></div></td>
			<td><input id="part-view" size="2" /></td>
			<td></td>

			<td align="right"><p>Number of Attractors:</p></td>
			<td><div class="slider" id="attSlider" tabIndex="1">
				<input class="slider-input" id="attSliderInput"/></div></td>									
			<td><input id="att-view" size="2" /></td>
		</tr>	
		
		<tr>	
			<td align="right"><p>Tail Length:</p></td>
			<td><div class="slider" id="tailSlider" tabIndex="1">
				<input class="slider-input" id="tailSliderInput"/></div></td>
			<td><input id="tail-view" size="2" /></td>
			<td></td>

			<td align="right"><p>Gravity Strength:</p></td>
			<td><div class="slider" id="gSlider" tabIndex="1">
				<input class="slider-input" id="gSliderInput"/></div></td>						
	
			<td><input id="g-view" size="2" /></td>
			<td> </td>
						
		</tr>
		
		<tr>	
			<td align="right"><p>Confine Particles to Canvas:</p></td>
			<td><select id="confine">	
					<option value="0" selected>Yes</option>
					<option value="1">No</option>						
				</select></td>
			<td> </td>
			<td></td>

			<td> </td>
			<td><input type="button" name="refresh-part" value="Refresh Particles" onClick="makeParticles();" /></td>			
			<td> </td>
			<td> </td>
		</tr>

		<tr>	
			<td align="right"><p>Particles influence each other:</p></td>						
			<td><select id="massive">	
					<option value="0" selected>Yes</option>
					<option value="1">No</option>						
				</select></td>	
			<td> </td>
			<td></td>

			<td> </td>
			<td><input type="button" name="refresh-att" value="Refresh Attractors" onClick="makeAttractors();" /></td>									
			<td> </td>
			<td> </td>
		</tr>
		
		
			
	</table>
<script type="text/javascript">

var canvas,ctx;
var WIDTH = 750;
var HEIGHT = 750;

var COLOR = "rgb(255,255,255)";

var V_MAX = 15;

var N_MIN = 1;
var N = 5;
var N_MAX = 50;

var TAIL_MIN = 1;
var TAIL = 10;
var TAIL_MAX = 25;

var ATT_MASS_MIN = 10; 
var ATT_MASS_MOD = 10;

var ATT_N_MIN = 0;
var ATT_N = 2;
var ATT_N_MAX = 10;

var G_POW_MIN = -5;
var G_POW = 0;
var G_POW_MAX = 5;

var pos_x, pos_y, vel_x, vel_y, acc_x, acc_y, mass, color;
var att_pos_x, att_pos_y, att_mass;

var partSl = new Slider(document.getElementById("partSlider"), document.getElementById("partSliderInput"));
var tailSl = new Slider(document.getElementById("tailSlider"), document.getElementById("tailSliderInput"));
var attSl  = new Slider(document.getElementById("attSlider"),  document.getElementById("attSliderInput"));
var gSl    = new Slider(document.getElementById("gSlider"),    document.getElementById("gSliderInput"));	
	
partSl.setMinimum(N_MIN);
partSl.setValue(N);
partSl.setMaximum(N_MAX);
document.getElementById("part-view").value = N;
	
tailSl.setMinimum(TAIL_MIN);
tailSl.setValue(TAIL);
tailSl.setMaximum(TAIL_MAX);
document.getElementById("tail-view").value = TAIL;		
		
attSl.setMinimum(ATT_N_MIN);
attSl.setValue(ATT_N);
attSl.setMaximum(ATT_N_MAX);
document.getElementById("att-view").value = ATT_N;				

gSl.setMinimum(G_POW_MIN);
gSl.setValue(G_POW);
gSl.setMaximum(G_POW_MAX);
document.getElementById("g-view").value = G_POW;				
		
function init(){

	// get the canvas element using the DOM
	canvas = document.getElementById("canvas");
	canvas.width = WIDTH;
	canvas.height = HEIGHT;	
	
	// Make sure we don't execute when canvas isn't supported
	if (canvas.getContext){
		// use getContext to use the canvas for drawing
		ctx = canvas.getContext('2d');	

		// set up the particles	and attractors
		makeParticles();
		makeAttractors();
		
		// call the drawing function
		return setInterval(draw, 10);	
	} 
	else { alert('You need a better web browser to see this.'); }
}	

function circle(x,y,r,c) {
	ctx.fillStyle = c;
	ctx.beginPath();
	ctx.arc(x, y, r, 0, Math.PI*2, true);
	ctx.closePath();
	ctx.fill();
}

function rect(x,y,w,h) {
	ctx.beginPath();
	ctx.rect(x,y,w,h);
	ctx.closePath();
	ctx.fill();
}

function curve(index) {		
	for(var j=0; j<TAIL; j++) 		
		circle(pos_x[index][j],pos_y[index][j],2*mass[index]*(TAIL-j)/TAIL,color[index]);
}

function clear() {
	ctx.clearRect(0, 0, WIDTH, HEIGHT);
}

function makeAttractors() {
	att_pos_x = new Array(ATT_N_MAX);
	att_pos_y = new Array(ATT_N_MAX);
	att_mass  = new Array(ATT_N_MAX);

	for(var i=0; i<ATT_N_MAX; i++) {
		att_pos_x[i] = (Math.random()*WIDTH+1)%WIDTH; //random integer between 0 and WIDTH-1
		att_pos_y[i] = (Math.random()*HEIGHT+1)%HEIGHT; //random integer between 0 and HEIGHT-1
		att_mass[i]  = (Math.random()*ATT_MASS_MOD+1)%ATT_MASS_MOD + ATT_MASS_MIN; //random integer	
	}
}

function makeParticles() {

	pos_x = new Array(N_MAX);
	pos_y = new Array(N_MAX);
	vel_x = new Array(N_MAX);
	vel_y = new Array(N_MAX);
	acc_x = new Array(N_MAX);
	acc_y = new Array(N_MAX);
	mass  = new Array(N_MAX);
	color = new Array(N_MAX);

	// make largest possible arrays, for continuity when changing N
	for(var i=0; i<N_MAX; i++) {
	
		// each position is an array holding (at most) the previous TAIL_MAX positions 
		pos_x[i] = new Array(TAIL_MAX);
		pos_y[i] = new Array(TAIL_MAX);

		// fill positions randomly
		pos_x[i][0] = (Math.random()*WIDTH+1)%WIDTH; //random integer between 0 and WIDTH-1
		pos_y[i][0] = (Math.random()*HEIGHT+1)%HEIGHT; //random integer between 0 and WIDTH-1
		
		// fill stored positions with first position
		for(var j=1; j<TAIL; j++) {
			pos_x[i][j] = pos_x[i][0];			
			pos_y[i][j] = pos_y[i][0];
		}
		
		// no initial velocities
		vel_x[i] = 0;
		vel_y[i] = 0;
		
		// no initial accelerations
		acc_x[i] = 0;
		acc_y[i] = 0;
		
		// random masses
		mass[i] = (Math.random()*4+1)%4 + 1; //random integer between 1 and 4
		
		// random colors
		color[i] = 'rgb(' + Math.round(Math.random()*256+1)%256 + ',' 
						  + Math.round(Math.random()*256+1)%256 + ',' 
						  + Math.round(Math.random()*256+1)%256 + ')';					
	}		
}

function draw() {	
	
	// draw the background and attractor
	ctx.fillStyle = "rgb(120,120,120)";
	rect(0,0,WIDTH,HEIGHT);
	for(var j=0; j<ATT_N; j++) 
		circle(att_pos_x[j],att_pos_y[j],att_mass[j],COLOR);
	
	// draw N particles
	for(var i=0; i<N; i++) {
	
		var r_squared = 0;
		var G = 1/(10*Math.pow(10,-1*G_POW/5));
	
		// reset accelerations
		acc_x[i] = 0;
		acc_y[i] = 0;
		
		// forces from the attractors
		for(var j=0; j<ATT_N; j++) {
			r_squared = (pos_x[i][0]-att_pos_x[j])*(pos_x[i][0]-att_pos_x[j]) + (pos_y[i][0]-att_pos_y[j])*(pos_y[i][0]-att_pos_y[j]);
			acc_x[i] += G*(att_mass[j]/r_squared)*(att_pos_x[j]-pos_x[i][0]);
			acc_y[i] += G*(att_mass[j]/r_squared)*(att_pos_y[j]-pos_y[i][0]);
		}		

		if(document.getElementById("massive").value == 0) {
			// forces from the other particles
			for(var j=0; j<N; j++) {			
				if( j != i ) {
					r_squared = (pos_x[i][0]-pos_x[j][0])*(pos_x[i][0]-pos_x[j][0]) 
								+ (pos_y[i][0]-pos_y[j][0])*(pos_y[i][0]-pos_y[j][0]);
					acc_x[i] += G*(mass[j]/r_squared)*(pos_x[j][0]-pos_x[i][0]);
					acc_y[i] += G*(mass[j]/r_squared)*(pos_y[j][0]-pos_y[i][0]);
				}
			}
		}
		
		// keep velocity bounded --FIX THIS?
		if (vel_x[i] + acc_x[i] < V_MAX && vel_x[i] + acc_x[i] > -1*V_MAX) 
			vel_x[i] = vel_x[i] + acc_x[i];			
		if (vel_y[i] + acc_y[i] < V_MAX && vel_y[i] + acc_y[i] > -1*V_MAX) 
			vel_y[i] = vel_y[i] + acc_y[i];	

			
		// if keeping the particles inside the canvas...			
		if (document.getElementById("confine").value == 0) {				
			if (pos_x[i][0] + vel_x[i] > WIDTH || pos_x[i][0] + vel_x[i] < 0)
				vel_x[i] = -vel_x[i];
			if (pos_y[i][0] + vel_y[i] > HEIGHT || pos_y[i][0] + vel_y[i] < 0)
				vel_y[i] = -vel_y[i];
		}
		
		// update current position
		pos_x[i][0] += vel_x[i];
		pos_y[i][0] += vel_y[i];
				
		// keep track of previous positions		
		for(var j=TAIL-1; j>0; j--) {
			pos_x[i][j] = pos_x[i][j-1];
			pos_y[i][j] = pos_y[i][j-1];
		}
			
		// draw the particles
		curve(i);		
	}
}

partSl.onchange = function () {	
    document.getElementById("part-view").value = partSl.getValue();
	N = parseInt(partSl.getValue());	
};

tailSl.onchange = function () {	
    document.getElementById("tail-view").value = tailSl.getValue();
	TAIL = parseInt(tailSl.getValue());	
};

attSl.onchange = function () {	
    document.getElementById("att-view").value = attSl.getValue();
	ATT_N = parseInt(attSl.getValue());	
};

gSl.onchange = function () {	
    document.getElementById("g-view").value = gSl.getValue();
	G_POW = parseInt(gSl.getValue());	
};

window.onresize = function () {
	partSl.recalculate();
	tailSl.recalculate();
	attSL.recalculate();
	gSl.recalculate();
	init();
};		
</script>	

</div>

<div class="middle">
    <canvas id="canvas" width="750" height="750">
        <p>Your browser is currently unsupported.</p>
        <p>Supported browsers: <a href="http://www.opera.com">Opera</a>, <a 
          href="http://www.mozilla.com">Firefox</a>, <a 
          href="http://www.apple.com/safari">Safari</a>, and <a 
          href="http://www.konqueror.org">Konqueror</a>.</p>
    </canvas>
</div>

<div class="bottom">
<p>last modified: 1/11/2010</p>
</div>

</div>

</body>
</html>
