<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />	
	<title>Michael Bradford Williams</title>
	<link rel="stylesheet" type="text/css" href="./css/styles.css" /> 
	<link rel="shortcut icon" href="favicon.ico" />
	<script language="JavaScript" type="text/javascript" src="./js/jscript.js"></script>
	<script type="application/x-javascript">
<!--  

var canvas,ctx;
var width = window.outerWidth;
var height = window.outerHeight;
var WIDTH, HEIGHT;
var canvasMinX;
var canvasMinY;
var posX, posY, mouseX, mouseY;

var M = 100; 
var Jlin = [1000000];
var Jquad = [1000000];
var x = [];
var y = [];
var alpha = 1;
var t0_init = 0;
var t1_init = 0;
var t2_init = 1;
var spread = 0;
var m = [];
var b = [];
var t0 = [];
var t1 = [];
var t2 = [];
var pointColor = 'black';
var pointRadius = 5;
var linear = 1;
var quadratic = 0;


function init(){

	// get the canvas element using the DOM
	canvas = document.getElementById("canvas");
	canvas.width = 750;//width - 25;
	canvas.height = 750;//height - 125;	
	WIDTH = canvas.width;
	HEIGHT = canvas.height;
	
	canvasMinX = findPos(canvas)[0];
	canvasMinY = findPos(canvas)[1];	
	
	// Make sure we don't execute when canvas isn't supported
	if (canvas.getContext){
		
		// use getContext to use the canvas for drawing
		ctx = canvas.getContext('2d');	
		
		// parameters to create the random data
		// A(x-B)^2+C = Ax^2 -2ABx + AB^2+C 
		t0_init = 0.8;
		t1_init = 0;
		t2_init = -1;
		spread = 0.25;
		
		refreshData();
		
	}
	else alert('You need a better web browser to see this.'); 
}


function gdIter() {

	var Jlin_temp = 0; //cost function for linear regression
	var J_m = 0; //partial derivative of Jlin w.r.t. m
	var J_b = 0; //partial derivative of Jlin w.r.t. b

	var Jquad_temp = 0; //cost function for quadratic regression
	var J_2 = 0; //partial derivative of Jquad w.r.t. t2
	var J_1 = 0; //partial derivative of Jquad w.r.t. t1
	var J_0 = 0; //partial derivative of Jquad w.r.t. t0
	
	var L = t2.length; //# of iterations
	
	// calculate the gradient of cost
	for(var i=0; i<M; i++) {
	
		// (signed) vertical distance between data point 
		// and current regression line: h(x)-y = mx + b - y
		var diff_lin = m[L-1]*x[i] + b[L-1] - y[i];
		
		J_m       += diff_lin*x[i];
		J_b       += diff_lin;
		Jlin_temp += diff_lin*diff_lin;
	
		// (signed) vertical distance between data point 
		// and current regression line: h(x)-y = t2 x^2 + t1 x + t0 - y
		var diff_quad = t2[L-1]*x[i]*x[i] + t1[L-1]*x[i] + t0[L-1] - y[i];
		
		J_2       += diff_quad*x[i]*x[i];
		J_1       += diff_quad*x[i];
		J_0       += diff_quad;
		Jlin_temp += diff_quad*diff_quad;
	}
	
	// update Jlin, m, and b based on the gradient
	Jlin[L] = Jlin_temp/(2*M);
	m[L] = m[L-1] - alpha*J_m/M;
	b[L] = b[L-1] - alpha*J_b/M;
	
	// update J, m, and b based on the gradient
	Jquad[L] = Jquad_temp/(2*M);
	t2[L] = t2[L-1] - alpha*J_2/M;
	t1[L] = t1[L-1] - alpha*J_1/M;
	t0[L] = t0[L-1] - alpha*J_0/M;

}


function refreshData() {
	
	//document.outform.output.value = "";
	
	// usual starting data
	m = [0];
	b = [Math.random()];
	
	t2 = [0];
	t1 = [0];
	t0 = [Math.random()];
	
	clear();
	initPoints(M);
	drawPoints();
	drawLines();
}


function iterate2() {
	
	clear();
	gdIter();
	drawPoints();
	drawLines();
	drawVerts();
}


function drawAfterChange() {

	clear();
	drawPoints();
	drawLines();
	drawVerts();
}


function initPoints() {
	
	// create M points 'near' the line y = t2_init * x^2 + t1_init * x + t0_init
	for(var i=0; i<M; i++) {	
		x[i] = Math.random();
		y[i] = t2_init*x[i]*x[i] + t1_init*x[i] + t0_init
			   + (2*Math.random()-1)*spread*Math.random();
	}
	
	
}


function drawPoints() {

	for(var i=0; i<M; i++) 
		drawDot(x[i]*WIDTH,
			y[i]*HEIGHT,
			pointRadius,
			pointColor);
}


function drawVerts() {

	var L = t2.length;

	for(var i=0; i<M; i++) {

		if( document.controls.regtype.value == "lin" ) 
			drawLine(x[i]*WIDTH,
				 y[i]*HEIGHT,
				 x[i]*WIDTH,
				 (m[L-1]*x[i] + b[L-1])*HEIGHT,
				 'red');
		
		if( document.controls.regtype.value == "quad" ) 
			drawLine(x[i]*WIDTH,
				y[i]*HEIGHT,
				x[i]*WIDTH,
				(t2[L-1]*x[i]*x[i] + t1[L-1]*x[i] + t0[L-1])*HEIGHT,
				'red');
	}
	
	
}


function drawLines() {
	
	var L = t2.length;

	// draw all but final line, scaling the color from light to dark
	for(var i=0; i<L-1; i++) {

		// evenly divide interval [0,255] and step through backwards
		var c = Math.round((L-i)*255/L);

		if( document.controls.regtype.value == "lin" )
			drawLine(0,
				b[i]*HEIGHT,
				1*WIDTH,
				(m[i]*1 + b[i])*HEIGHT,
				'rgb(' + c + ',' + c + ',' + c + ')');
		if( document.controls.regtype.value == "quad" )
			for(var j=0; j<WIDTH; j++) 
				drawDot(j,
					(t2[i]*j*j/(WIDTH*WIDTH) + t1[i]*j/WIDTH + t0[i])*HEIGHT,
					1,
					'rgb(' + c + ',' + c + ',' + c + ')');
	
	}
	
	// draw the final line in black
	if( document.controls.regtype.value == "lin" )
		drawLine(0,
			b[L-1]*HEIGHT,
			1*WIDTH,
			(m[L-1]*1 + b[L-1])*HEIGHT,
			'black');
	if( document.controls.regtype.value == "quad" )
		for(var j=0; j<WIDTH; j++) 
			drawDot(j,
				(t2[L-1]*j*j/(WIDTH*WIDTH) + t1[L-1]*j/WIDTH + t0[L-1])*HEIGHT,
				1,
				'black');
}



function rect(x,y,w,h) {
	ctx.beginPath();
	ctx.rect(x,y,w,h);
	ctx.closePath();
	ctx.fill();
}

function clear() {
	ctx.fillStyle = 'white';
	rect(0, 0, WIDTH, HEIGHT);
}

function drawLine(x0,y0,x1,y1,c) {
	ctx.beginPath();
	ctx.strokeStyle = c;
	ctx.moveTo(x0,y0);
	ctx.lineTo(x1,y1);
	ctx.closePath();
	ctx.stroke();	
}

function drawDot(x,y,r,c) {
	ctx.beginPath();		
	ctx.fillStyle = c;
	ctx.arc(x,y,r,0,2*Math.PI,true);
	ctx.closePath();
	ctx.fill();
}

function drawCircle(x,y,r,c) {
	ctx.beginPath();
	ctx.strokeStyle = c;		
	ctx.arc(x,y,r,0,2*Math.PI,true);
	ctx.closePath();
	ctx.stroke();
}


// find the position of the upper-left corner of an object (e.g., the canvas)
function findPos(obj) {
	var curLeft = 0;
	var curTop = 0;
	
	if(obj.offsetParent) {		
		do {
			curLeft += obj.offsetLeft;
			curTop += obj.offsetTop;
		} while (obj = obj.offsetParent);
	}
	
	return [curLeft,curTop];
}


-->
	</script>	
</head>
  
<body onload="init();">

<div class="container">

<a href="./index.html">
<div class="topsmall">

<div class="topleftsmall">
   <script>
      showImage("300x50");
   </script>
</div>

<h1>Michael Bradford Williams</h1>

</div>
</a>

<div class="middle">

<h2>Linear Regression via Gradient Descent</h2>

<p>Given a set of data, <a href="http://en.wikipedia.org/wiki/Linear_regression">linear regression</a> is a way to fit a linear model to the data. This is done by minimizing a certain "cost function", which measures the deviation of the data from the hypothesized linear model. The linear model with the least cost then has the "best fit" for the data.
</p>

<p>Consider a set of 2-dimensional data, that is, a collection of points <i>(x,y)</i> in the plane. A linear model for this data will be a line of the form <i>y=mx+b</i>. We hope to find the values of slope <i>m</i> and intercept <i>b</i> that minimize the cost function, which we take as the average of the squared vertical distances from the data points to the line:
</p>

<table  align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr align="center">
	<td>
	    <img src="./images/cost.png" alt="cost function" />
	</td>
</tr>
</table>

<p>How do we find the values of <i>m</i> and <i>b</i> that minimize <i>J(m,b)</i>? This is a multivariable <a href="http://en.wikipedia.org/wiki/Optimization_problem">optimization problem</a>, and one method is to use <a href="http://en.wikipedia.org/wiki/Gradient_descent">gradient descent</a>. The idea is that the (negative) <a href="http://en.wikipedia.org/wiki/Gradient">gradient</a> of <i>J</i> points in the direction of steepest descrease of <i>J</i>, so if we incrementally follow the gradient of <i>J</i>, we will eventually reach a minimizer. The gradient is just the vector of partial derivatives of <i>J</i>:</p>

<table  align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr align="center">
	<td>
	    <img src="./images/grad.png" alt="gradient of cost" />
	</td>
</tr>
</table>

<p>In general, the minimizer found by gradient descent will only be local, but it turns out that the cost function above always has a unique global minimizer. Here is the algorithm. Think of the variables <i>m</i> and <i>b</i> as a point <i>(m,b)</i> in the plane.</p>
<ol>
<li>Randomly select initial values <i>(m,b)</i>, and choose a small positive number &alpha;.</li>
<li>Update <i>(m,b)</i> according to the following replacement:</li>
<table  align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr align="center">
	<td>
	    <img src="./images/update.png" alt="gradient descent" />
	</td>
</tr>
</table>
<li>Repeat Step 2 as many times as needed.</li>
</ol>

<p>One can also consider more complicated models, such as quadratics: <i>y = ax<sup>2</sup> + bx + c</i>. Gradient descent still works in such cases, with appropriate cost function.
</p>

<p>The app below illustrates how gradient descent finds the line/parabola of best fit. Random data is selected, and you can repeatedly perform Step 2 in the gradient descent algorithm.
</p>


<p>You'll need a modern browser to view the app. It has been tested in <a 
href="http://www.mozilla.com/firefox/">Firefox</a> (Windows/Linux) and <a 
href="http://www.google.com/chrome">Chrome</a> (Windows).</p> 
</div>

<div class="middle">
<table border="0" align="center">
	<tr>
		<td><b>Regression Type:</b>
		</td>
		<td>
			<form name="controls">
			Linear<input type="radio" name="regtype" value="lin" onChange="drawAfterChange();" checked="yes">
			Quadratic<input type="radio" name="regtype" value="quad" onChange="drawAfterChange();"> 
			</form>
		</td>
		<td align="left">
			<input type="button" name="iterate" value="Iterate" onClick="iterate2();">
			<input type="button" name="reset" value="Reset" onClick="refreshData();">
			</form>
		</td>
	</tr>
</table>
</div>

<div class="middle">  
<center>
    <canvas id="canvas" width="750" height="750">
        <p>Your browser is currently unsupported.</p>
        <p>Supported browsers: <a href="http://www.opera.com">Opera</a>, <a 
          href="http://www.mozilla.com">Firefox</a>, <a 
          href="http://www.apple.com/safari">Safari</a>, and <a 
          href="http://www.konqueror.org">Konqueror</a>.</p>
    </canvas>
</center>
</div>

<!--
<div class="middle">
<table>
	<tr>
		<td><form name="outform">   
		    <textarea rows="5" cols="100" name="output"></textarea>    
		    </form>
		</td>
	</tr>
</table>
</div>
-->

<div class="bottom">
<p>last modified: 12/24/2014</p>

</div>

</div>

</body>
</html>
